{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/app/index.ts"],"names":[],"mappings":"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","sourcesContent":["\r\n\r\nexport async function DocReady(): Promise<void> {\r\n    const result = new Promise<void>((resolve, reject) => {\r\n        document.addEventListener(\"readystatechange\", () => {\r\n            if (document.readyState === \"complete\") {\r\n\r\n                    resolve();\r\n  \r\n            }\r\n        });\r\n    });\r\n    return result;\r\n}\r\n\r\n\r\nexport async function AwaitAnimationFrame(): Promise<void> {\r\n    const result = new Promise<void>((resolve, reject) => {\r\n        requestAnimationFrame(() => {\r\n            resolve();\r\n        });\r\n    });\r\n    return result;\r\n}\r\n\r\nexport interface FileLike {\r\n    name: string;\r\n    fullName: string;\r\n    extension: string;\r\n}\r\n\r\nexport interface DirectoryLike {\r\n    name: string;\r\n    fullName: string;\r\n    extension: string;\r\n\r\n    directories?: Array<DirectoryLike>;\r\n    files?: Array<FileLike>;   \r\n}\r\n\r\nexport declare function getDirectory(path: string): DirectoryLike;\r\n\r\nexport declare function getFile(path: string): string;\r\n\r\nexport function Guid() {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'\r\n        .replace(/[xy]/g, function (c) {\r\n            const r = Math.random() * 16 | 0,\r\n                v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n}\r\n\r\nexport class Speaker {\r\n\r\n\r\n\r\n    public Say(text: string, gender: VoiceGender = VoiceGender.Female): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            const promptId = Guid();\r\n            if (this.Done) {\r\n                let previous = this.Done;\r\n                this.Done = (id: string) => {\r\n                    if (id === promptId) {\r\n                        resolve();\r\n                    } else {\r\n                        previous(id);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.Done = (id: string) => {\r\n                    if (id === promptId) {\r\n                        resolve();\r\n                    }\r\n                };\r\n            }\r\n\r\n\r\n\r\n\r\n            (<any>globalThis).serverSpeaker.say(text, promptId, gender);\r\n        }); \r\n      \r\n    }\r\n\r\n    public Done: (id:string) => void;\r\n}\r\n\r\n\r\nexport enum VoiceGender {\r\n    NotSet = 0,\r\n    Male = 1,\r\n    Female = 2,\r\n    Neutral = 3,\r\n}\r\n\r\nexport async function test() {\r\n\r\n  \r\n\r\n    let files = new Array<FileLike>();\r\n    for (let i = 1; i < 218; i++) {\r\n        \r\n        let name = `onePiece_Page${i}.png`\r\n        let fullName = \"comic/\" + name;\r\n\r\n        files.push(<FileLike>{ name: name, extension: \".png\", fullName: fullName })\r\n    }\r\n    (<any>globalThis).Speaker = new Speaker();\r\n    const player = new XCBZPlayer(\"viewPort\", files);\r\n    (<any>globalThis).player = player;\r\n    (<any>globalThis).Rect = Rect;\r\n\r\n\r\n  \r\n\r\n}\r\n\r\nexport class Point {\r\n    public constructor(public X: number, public Y: number) {\r\n\r\n    }\r\n}\r\n\r\nexport class Rect {\r\n    public constructor(public X: number, public Y: number, public Width:number, public Height:number) {\r\n\r\n    }\r\n    public get MigPoint() {\r\n        return new Point(this.X + this.Width, this.Y + this.Height);\r\n    }\r\n}\r\n\r\n    export class XCBZPlayer {\r\n    private context: CanvasRenderingContext2D;\r\n    private width: number;\r\n    private height: number; \r\n\r\n        private async Load(path: string, id: string): Promise<HTMLImageElement> {  \r\n            const prelImg = document.getElementById(id);\r\n            if (prelImg) {\r\n                return <HTMLImageElement>prelImg;\r\n            }\r\n\r\n            const result = <HTMLImageElement>document.createElement(\"img\");\r\n            result.src = path;\r\n            result.id = id;\r\n            result.style.display = \"none\";\r\n            document.body.appendChild(result);\r\n\r\n            AwaitAnimationFrame();\r\n\r\n            return result;\r\n        }\r\n\r\n        public async LoadPage(index: number): Promise<ImageBitmap> {\r\n            return await this.GetImage(index);\r\n            // return await this.Load(this.files[index].fullName, `page_${index}`);\r\n        }\r\n\r\n        private imgCache: Array<ImageBitmap> = [];\r\n\r\n        public async GetImage(index: number): Promise<ImageBitmap> {\r\n            if (this.imgCache[index]) {\r\n                return this.imgCache[index];\r\n            }\r\n\r\n            var result = await this.loadImage(this.files[index].fullName);\r\n\r\n            this.imgCache[index] = result;\r\n\r\n            return result;\r\n        }\r\n      \r\n\r\n        private DrawImg(img: ImageBitmap, source: Rect, target: Rect) {\r\n       \r\n\r\n            this.context.drawImage(img,\r\n                source.X, source.Y, source.Height, source.Width,\r\n                target.X, target.Y, target.Width, target.Height);\r\n        }\r\n        private async Draw(index: number, source: Rect, target: Rect): Promise<void> {\r\n            var image = await this.LoadPage(index);\r\n            this.context.drawImage(image,\r\n                source.X, source.Y, source.Width, source.Height,\r\n                target.X, target.Y, target.Width, target.Height);\r\n        }\r\n\r\n\r\n        public constructor(\r\n            private canvasId: string,\r\n            private files: Array<FileLike>\r\n        ) {\r\n        const viewPort = <HTMLCanvasElement>document.getElementById(canvasId);\r\n            this.width = viewPort.width;\r\n            this.height = viewPort.height;\r\n            this.context = viewPort.getContext(\"2d\");\r\n            //this.files.forEach(n => n.name)\r\n       \r\n          \r\n\r\n\r\n        }\r\n\r\n        public loadImage(url: string): Promise<ImageBitmap> {\r\n            return fetch(url).then(reponse => reponse.blob()).then(blob => createImageBitmap(blob));\r\n        }\r\n\r\n\r\n        public async Play(): Promise<void> {\r\n   \r\n            await this.Draw(4, new Rect(440, 200, 640, 540), new Rect(0, 0, 640/3, 540/3));\r\n            await (<any>globalThis).Speaker.Say(\"Gold Roger, The king of the pirates, had achieved  it all.\");\r\n            await (<any>globalThis).Speaker.Say(\"Wealth, fame and power had all been his.\");\r\n            await (<any>globalThis).Speaker.Say(\"Not Surprisingly, The Final word he spoke before they lopped of his head inspired adventurers throughout the world to sail the seas.\");\r\n\r\n            await this.Draw(4, new Rect(0, 830, 1500, 1560), new Rect(0, 0, 1500 / 5, 1560 / 5));\r\n            await (<any>globalThis).Speaker.Say(\"My Tresure?\", VoiceGender.Male);\r\n            await (<any>globalThis).Speaker.Say(\"Why, It's right where i left it...\", VoiceGender.Male);\r\n            await (<any>globalThis).Speaker.Say(\"It's yours if you can find it.\", VoiceGender.Male);\r\n            await (<any>globalThis).Speaker.Say(\"But you'll have to search the whole world!\", VoiceGender.Male);\r\n\r\n            await (<any>globalThis).Speaker.Say(\"Shunk!\");\r\n\r\n            await (<any>globalThis).Speaker.Say(\"The world...\");\r\n            await (<any>globalThis).Speaker.Say(\"...is about to witness a great era of piracy!\");\r\n\r\n\r\n        }\r\n\r\n\r\n\r\n}"]}